jQuery(document).ready(function(m){var l,c,d,e,t,n,u,v,i,o,g,s,b,h,a,r,f,p,y,C,w,k,x,H,S,T,D,I,P,j,q,L,z,E,W,B,G;return d=m("body"),b=m("main"),D=m(".section-titles"),l=m("#archive"),c=m(".archive-medias"),m("#lightbox"),s=m("#lightbox-media"),u=m("header.desktop"),m("header.mobile"),i=m("footer"),.8,200,500,30,g=function(){return!!['""mobile""','"mobile"',"mobile"].includes(d.css("content"))},I=function(e){var t,n,i,o,a;if(e.preventDefault(),e.stopPropagation(),n=m(this).data("id"),i=m(this).data("title"),a=this.href,t=u.find(".chapter-title"),history.pushState(null,null,a),o=b.position().top,m("html, body").animate({scrollTop:o},500),b.data("id")!==n)return b.addClass("loading").data("id",n).data("url",a),t.attr("href",a).find("h3").html(i),C(n),!1},C=function(e){var t;return b.removeClass("loaded").addClass("loading"),t=SiteSettings.url.api+"chapter/"+e,m.ajax({url:t,type:"GET",dataType:"html",success:function(e){return console.log(e),b.html(e),b.removeClass("loading").addClass("loaded"),x()},error:function(e,t,n){return console.log(e,t,n)}})},x=function(){var t;return t=m(".blocks"),console.log(t),D.html(""),t.find(".section-title").each(function(e,t){var n,i,o;if(i=m(t).find(".section-title-text").text())return n=z(i),m(t).attr("id",n),o=m('<h5 class="section-title"></h5>').attr("data-slug",n).html('<a href="#'+n+'" class="section-anchor">'+i+"</a>"),D.append(o)}),t.find(".media-block").each(function(e,t){var n;if(m(t).is(".full-media-block")||m(t).is(".center-media-block")){if((n=m(t).find(".block-body")).text())return;return n.parents(".block-text").length&&n.parents(".block-text").remove(),n.remove()}}),t.find("video").each(function(e,t){var n,i;if((n=m(t).parent()).append(m('<div class="btn"></div>')),g())t.autoplay=!1,t.muted=!1,t.volume=1;else if(t.autoplay=!0,n.addClass("muted mutable"),void 0!==(i=t.play()))return i.then(function(){return m(t).on("timeupdate",function(){var e;return e=m(t=this).parent(".media"),t.paused?e.addClass("muted"):(e.removeClass("muted"),m(t).off("timeupdate"))})}).catch(function(e){return console.log(e)})}),t.imagesLoaded().always(function(){var e;return(e=window.location.hash)&&T(e,!1),m(window).on("scroll",p),t.addClass("loaded"),p()})},k=function(){return c.masonry({itemSelector:".col",transitionDuration:0}),c.masonry("on","layoutComplete",function(){return c.addClass("masonry")}),c.find(".block-media").each(function(e,t){var n;return n=m(t).find("video"),m(t).find("img").length?m(t).find("img")[0].onload=function(){if(c.is(".masonry"))return c.masonry()}:n.length?(g()?n[0].controls=!0:(n[0].controls=!1,m(t).addClass("paused")),m(t).find("video").on("loadeddata",function(){if(c.is(".masonry"))return c.masonry()})):void 0})},j=function(e){var t;return e.preventDefault(),t=e.target.hash,history.pushState(null,null,t),T(t,!0)},T=function(e,t){var n,i,o,a;if(e=decodeURIComponent(e),(o=m(".section-title"+e)).length?(a=o.position().top,"none"!==u.css("display")&&(a-=u.innerHeight()+1),t?m("html, body").animate({scrollTop:a},500):m("html, body").scrollTop(a)):m("html, body").scrollTop(0),e.includes("#archive")){if(E(),n=parseInt(e.split("-")[1]),!Number.isInteger(n))return;if(i=m(c.find(".archive-media")[n-1]))return w(i)}},H=function(){return m(".block-media.slideshow").each(function(e,o){var a;return a=0,(o=m(o)).imagesLoaded().progress(function(e,t){var n,i;if(n=t.img,i=m(n).parent(),n.naturalHeight>a)return a=n.naturalHeight,o.find(".static").removeClass("static"),o.attr("data-ratio",n.naturalHeight/n.naturalWidth),i.addClass("static")}).done(function(e){return m(window).resize()}),setInterval(function(){var e;return o.find(".active").length&&(e=o.find(".active").next(".media")),e&&e.length||(e=o.find(".media").first()),o.find(".active").removeClass("active"),e.addClass("active")},5e3)})},e=function(e){var t,n;if(t=e.target.hash,n=m(t),t&&n&&n.length)return e.preventDefault(),e.stopPropagation(),w(n)},E=function(e){return e&&e.stopPropagation(),d.is(".open-archive")?(t(),e?e.preventDefault():void 0):y()},y=function(){return h(),D.find(".active").removeClass("active"),d.addClass("open-archive no-scroll"),c.masonry()},t=function(){var e;return d.removeClass("open-archive no-scroll"),e=window.location.href.split("#")[0],history.pushState(null,null,e),m(window).scroll()},P=function(e){var t,n;if(n=(t=m(this)).find("video"),g()&&n.length)n[0].paused?n[0].play():n[0].pause();else if(!t.find(".muted").length&&!m(e.target).is(".btn"))return w(t)},w=function(e){var t,n,i,o,a,r;if(e.length)return s=m("#lightbox-media"),e.find("object").length?(o=e.find("object")[0],n=m(o).clone()[0],s.append(n)):e.find("img").length?(a=e.find("img").attr("src"),s.css({backgroundImage:"url("+a+")"})):e.find("video").length?(r=e.find("video")[0],i=m(r).clone()[0],s.append(i),i.currentTime=r.currentTime,i.volume=.8,i.muted=!1,i.play()):e.css("background-image")&&(t=e.css("background-image"),s.css({backgroundImage:t})),d.addClass("open-lightbox no-scroll"),h()},n=function(e){var t;return s=m("#lightbox-media"),d.removeClass("open-lightbox no-scroll"),d.hasClass("open-archive")&&(t=window.location.href.split("#")[0],history.pushState(null,null,t+"#archive")),setTimeout(function(){return s.html("").attr("style","")},200),m(window).scroll()},function(){if(!g())return m(".media-block video").each(function(e,t){return t.muted=!1,t.play()})},h=function(){if(!g())return m(".media-block video").each(function(e,t){return t.volume=0})},G=function(){var e,t;return e=m(this).parents(".media"),t=m(e).find("video"),e.toggleClass("muted"),t[0].muted=e.is(".muted"),m(window).scroll()},B=function(e){return e.preventDefault(),e.stopPropagation(),d.toggleClass("open-menu no-scroll")},q=function(e){var t,n;if(t=m(this).data("id"),(n=m('.media[data-id="'+t+'"]')).length)return m(".media").removeClass("show"),n.addClass("show")},o=function(e){return m(".media").removeClass("show")},L=function(e){var t,n;return n=m(this).data("id"),t=m('.tab-content[data-id="'+n+'"]'),m(".tab, .tab-content").removeClass("active"),m(this).addClass("active"),t.addClass("active")},W=function(e){var t,n,i;return e.preventDefault(),e.stopPropagation(),n=m(this).parents(".expand-wrapper"),t=n.find(".expand-content"),n.toggleClass("open"),i=n.is(".open")?n.find(".expand-inner").innerHeight():0,t.animate({height:i},500,function(){if(n.is(".open"))return t.css({height:"auto"})})},f=function(e){if(i.length&&m(".blocks-inner").css({paddingBottom:i.innerHeight()+30}),m(".block-media.slideshow").each(function(e,t){var n,i;if(i=(t=m(t)).attr("data-ratio"))return n=t.innerWidth()*i,t.css({height:n+30+"px"})}),c.is(".masonry"))return c.masonry()},r=function(e){if("Escape"===e.key&&(d.is(".open-lightbox")&&n(),d.is(".open-archive")))return t()},S=0,p=function(e){var t,n,i,o,h,a,r,s,f,p;if(!d.is(".page")&&!d.is(".archive"))return p=m(window).innerHeight(),f=p/2,h=m(window).scrollTop(),p+h,S<h?"down":"up",o=b.position().top,t=b.data("url"),r=l.offset().top<=h+p,o<=h?d.addClass("in-chapter"):d.removeClass("in-chapter"),r?(d.addClass("show-archive"),m(".section-title").removeClass("active")):(d.removeClass("show-archive"),s=[],m(".block.section-title").each(function(e,t){var n;if(m(t).offset().top-u.innerHeight()-1<=h)return n=m(t).attr("id"),s.push(n)}),(n=s[s.length-1])?(i=D.find('[data-slug="'+n+'"]')).is(".active")||(i.addClass("active"),a=i.find("a").attr("href"),d.is(".open-archive")||d.is(".open-lightbox")||history.pushState(null,null,t+a)):window.location.hash.length&&(d.is(".open-archive")||d.is(".open-lightbox")||history.pushState(null,null,"#")),m(".section-title").not(i).removeClass("active")),c.find(".block-media video").each(function(e,t){return g()?t.controls=!0:(t.controls=!1,m(t).parents(".block").addClass("paused"))}),m(".media-block video").each(function(e,t){var n,i,o,a,r,s,l,c,d,u;return(n=m(t).parents(".media")).removeClass("paused"),g()?(n.removeClass("muted"),t.controls=!0,t.autoplay=!1,t.muted=!1,void(t.volume=1)):(t.controls=!1,t.autoplay=!0,s=(r=m(t).innerHeight()/2)+(c=m(t).offset().top),o=m(t).innerHeight()+c,d=c-h,l=h-s+f,a=o-h,u=n.is(".muted")?0:0<=l?v(a,0,f+r):v(d,p,f-r),t.volume=u,void 0!==(i=t.play())?i.then(function(){return 0<u?(m(t).addClass("play"),t.muted=!1):m(t).removeClass("play")}).catch(function(e){return console.log(e.message)}):void 0)}),S=h},a=function(){if(!g())return m(".media-block video").each(function(e,t){return t.play()})},v=function(e,t,n){var i;return.8<(i=.8*(e-t)/(n-t)+0)&&(i=.8),i<0&&(i=0),i},z=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},d.on("vclick",".body-text a",e),d.on("vclick",".archive-toggle",E),d.on("vclick",".menu-toggle",B),d.on("mouseenter",".chapter-square:not(.show)",q),d.on("mouseleave",".chapter-square",o),d.on("vclick",".tabs .tab:not(.active)",L),d.on("click",".expand-toggle",W),d.on("vclick",".section-anchor",j),d.on("click","a.chapter-square",I),d.on("click",".block-media",P),d.on("click",".mutable .btn",G),d.on("vclick",".lightbox-close, #lightbox-media",n),d.on("keyup",r),d.on("click",a),m(window).on("resize",f),m(window).on("load",function(){return x(),H(),k()}),f()});