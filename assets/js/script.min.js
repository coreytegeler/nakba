jQuery(document).ready(function(u){var n,s,e,i,h,f,a,t,r,m,l,o,c,d,v,p,g,b,y,C,w,k,x,H,T,S,j,D,I,q,L;return s=u("body"),m=u("main"),x=u(".section-titles"),u("#archive"),n=u(".archive-medias"),u("#lightbox"),r=u("#lightbox-media"),h=u("header.desktop"),u("header.mobile"),a=u("footer"),.8,200,500,30,H=function(t){var e,n,i,a,o;if(t.preventDefault(),n=u(this).data("id"),i=u(this).data("title"),o=this.href,e=h.find(".chapter-title"),history.pushState(null,null,o),a=m.position().top,u("html, body").animate({scrollTop:a},500),m.data("id")!==n)return m.addClass("loading").data("id",n).data("url",o),e.attr("href",o).find("h3").html(i),p(n)},p=function(t){return m.removeClass("loaded").addClass("loading"),u.ajax({url:ajax_obj.ajaxurl,type:"POST",dataType:"html",data:{action:"get_chapter",id:t},success:function(t){return m.html(t),m.removeClass("loading").addClass("loaded"),y()},error:function(t,e,n){return console.log(t,e,n)}})},y=function(){var e;return e=u(".blocks"),x.html(""),e.find(".section-title").each(function(t,e){var n,i,a;if(i=u(e).find(".section-title-text").text())return n=D(i),u(e).attr("id",n),a=u('<h5 class="section-title"></h5>').attr("data-slug",n).html('<a href="#'+n+'" class="section-anchor">'+i+"</a>"),x.append(a)}),e.find(".media-block").each(function(t,e){var n;if(u(e).is(".full-media-block")&&!(n=u(e).find(".block-body")).text())return n.remove()}),e.imagesLoaded().done(function(){var t;return(t=window.location.hash)&&k(t,!1),u(window).on("scroll",d),e.addClass("loaded"),d()})},b=function(){return n.masonry({itemSelector:".archive-media",transitionDuration:0}),n.masonry("on","layoutComplete",function(){return n.addClass("masonry")}),n.find("img").each(function(t,e){return e.onload=function(){if(n.is(".masonry"))return n.masonry()}}),n.find("video").each(function(t,e){return u(e).on("loadeddata",function(){if(n.is(".masonry"))return n.masonry()})})},T=function(t){var e;return t.preventDefault(),e=t.target.hash,history.pushState(null,null,e),k(e,!0)},k=function(t,e){var n,i,a;if(n=decodeURIComponent(t),(i=u(".section-title"+n)).length?(a=i.position().top,"none"!==h.css("display")&&(a-=h.innerHeight()+1),e?u("html, body").animate({scrollTop:a},500):u("html, body").scrollTop(a)):u("html, body").scrollTop(0),"#archive"===n)return I()},C=function(){return u(".block-media.slideshow").each(function(t,a){var o;return o=0,(a=u(a)).imagesLoaded().progress(function(t,e){var n,i;if(n=e.img,i=u(n).parent(),n.naturalHeight>o)return o=n.naturalHeight,a.find(".static").removeClass("static"),a.attr("data-ratio",n.naturalHeight/n.naturalWidth),i.addClass("static")}).done(function(t){return u(window).resize()}),setInterval(function(){var t;return a.find(".active").length&&(t=a.find(".active").next(".media")),t&&t.length||(t=a.find(".media").first()),a.find(".active").removeClass("active"),t.addClass("active")},5e3)})},I=function(t){return s.is(".open-archive")?(e(),t.preventDefault()):v()},v=function(){return l(),x.find(".active").removeClass("active"),s.addClass("open-archive no-scroll")},e=function(){var t;return s.removeClass("open-archive no-scroll"),t=window.location.href.split("#")[0],history.pushState(null,null,t),u(window).scroll()},g=function(t){var e,n,i,a,o;return i=u(this),r=u("#lightbox-media"),i.find("img").length?(a=i.find("img").attr("src"),r.css({backgroundImage:"url("+a+")"})):i.find("video").length?(o=i.find("video")[0],n=u(o).clone()[0],r.append(n),n.currentTime=o.currentTime,n.volume=.8,n.muted=!1,n.play()):i.css("background-image")&&(e=i.css("background-image"),r.css({backgroundImage:e})),s.addClass("open-lightbox no-scroll"),l()},i=function(t){return r=u("#lightbox-media"),s.removeClass("open-lightbox no-scroll"),setTimeout(function(){return r.html("").attr("style","")},200),u(window).scroll()},l=function(){return u(".media-block video").each(function(t,e){return e.volume=0})},L=function(t){return s.toggleClass("open-menu no-scroll")},S=function(t){var e,n;if(e=u(this).data("id"),(n=u('.media[data-id="'+e+'"]')).length)return u(".media").removeClass("show"),n.addClass("show")},t=function(t){return u(".media").removeClass("show")},j=function(t){var e,n;return n=u(this).data("id"),e=u('.tab-content[data-id="'+n+'"]'),u(".tab, .tab-content").removeClass("active"),u(this).addClass("active"),e.addClass("active")},q=function(t){var e,n,i;return n=u(this).parents(".expand-wrapper"),e=n.find(".expand-content"),n.toggleClass("open"),i=n.is(".open")?n.find(".expand-inner").innerHeight():0,e.animate({height:i},500,function(){if(n.is(".open"))return e.css({height:"auto"})})},c=function(t){if(a.length&&u(".blocks-inner").css({paddingBottom:a.innerHeight()+30}),u(".block-media.slideshow").each(function(t,e){var n,i;if(i=(e=u(e)).attr("data-ratio"))return n=e.innerWidth()*i,e.css({height:n+30+"px"})}),n.is(".masonry"))return n.masonry()},o=function(t){if("Escape"===t.key&&(s.is(".open-lightbox")&&i(),s.is(".open-archive")))return e()},w=0,d=function(t){var e,n,i,a,l,o,r,c,d;if(!s.is(".page")&&!s.is(".archive"))return d=u(window).innerHeight(),c=d/2,l=u(window).scrollTop(),d+l,w<l?"down":"up",a=m.position().top,e=m.data("url"),a<=l?s.addClass("in-chapter"):s.removeClass("in-chapter"),r=[],u(".block.section-title").each(function(t,e){var n;if(u(e).offset().top-h.innerHeight()-1<=l)return n=u(e).attr("id"),r.push(n)}),(n=r[r.length-1])?(i=x.find('[data-slug="'+n+'"]')).is(".active")||(i.addClass("active"),o=i.find("a").attr("href"),history.pushState(null,null,e+o)):window.location.hash.length&&history.pushState(null,null,"#"),u(".section-title").not(i).removeClass("active"),u(".media-block video").each(function(t,e){var n,i,a,o,r,s;return u(e).is(".init")||(u(e).addClass("init").attr("loop","loop"),e.play()),a=(i=u(e).innerHeight()/2)+(o=u(e).offset().top),n=u(e).innerHeight()+o,r=o-l,s=0<=l-a+c?f(n-l,0,c+i):f(r,d,c-i),e.volume=s}),w=l},f=function(t,e,n){var i;return.8<(i=.8*(t-e)/(n-e)+0)&&(i=.8),i<0&&(i=0),i},D=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},u("body").on("vclick",".archive-toggle",I),u("body").on("vclick",".menu-toggle",L),u("body").on("mouseenter",".chapter-square:not(.show)",S),u("body").on("mouseleave",".chapter-square",t),u("body").on("vclick",".tabs .tab:not(.active)",j),u("body").on("vclick",".expand-toggle",q),u("body").on("vclick",".section-anchor",T),u("body").on("vclick","a.chapter-square",H),u("body").on("vclick",".block-media",g),u("body").on("vclick",".lightbox-close, #lightbox-media",i),u("body").on("keyup",o),u(window).on("resize",c),u(window).on("load",function(){return y(),C(),b()}),c()});