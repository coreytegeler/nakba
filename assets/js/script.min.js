jQuery(document).ready(function(u){var l,e,n,h,f,i,t,r,v,s,a,o,c,d,p,g,m,b,y,w,C,k,x,H,T,S,j,I,q;return l=u("body"),v=u("main"),w=u(".section-titles"),u("#archive"),u("#lightbox"),r=u("#lightbox-media"),h=u("header.desktop"),u("header.mobile"),i=u("footer"),.8,200,500,30,C=function(t){var e,n,i,a,o;if(t.preventDefault(),n=u(this).data("id"),i=u(this).data("title"),o=this.href,e=h.find(".chapter-title"),history.pushState(null,null,o),a=v.position().top,u("html, body").animate({scrollTop:a},500),v.data("id")!==n)return v.addClass("loading").data("id",n).data("url",o),e.attr("href",o).find("h3").html(i),p(n)},p=function(t){return v.removeClass("loaded").addClass("loading"),u.ajax({url:ajax_obj.ajaxurl,type:"POST",dataType:"html",data:{action:"get_chapter",id:t},success:function(t){return v.html(t),v.removeClass("loading").addClass("loaded"),m()},error:function(t,e,n){return console.log(t,e,n)}})},m=function(){var e;return e=u(".blocks"),w.html(""),e.find(".section-title").each(function(t,e){var n,i,a;if(i=u(e).find(".section-title-text").text())return n=S(i),u(e).attr("id",n),a=u('<h5 class="section-title"></h5>').attr("data-slug",n).html('<a href="#'+n+'" class="section-anchor">'+i+"</a>"),w.append(a)}),e.find(".media-block").each(function(t,e){var n;if(u(e).is(".full-media-block")&&!(n=u(e).find(".block-body")).text())return n.remove()}),e.imagesLoaded().done(function(){var t;return(t=window.location.hash)&&y(t,!1),u(window).on("scroll",c),e.addClass("loaded"),c()})},k=function(t){var e;return t.preventDefault(),e=t.target.hash,history.pushState(null,null,e),y(e,!0)},y=function(t,e){var n,i,a;if(n=decodeURIComponent(t),(i=u(".section-title"+n)).length?(a=i.position().top,"none"!==h.css("display")&&(a-=h.innerHeight()+1),e?u("html, body").animate({scrollTop:a},500):u("html, body").scrollTop(a)):u("html, body").scrollTop(0),"#archive"===n)return j()},x=function(){return u(".block-media.slideshow").each(function(t,a){var o;return o=0,(a=u(a)).imagesLoaded().progress(function(t,e){var n,i;if(n=e.img,i=u(n).parent(),n.naturalHeight>o)return o=n.naturalHeight,a.find(".static").removeClass("static"),a.attr("data-ratio",n.naturalHeight/n.naturalWidth),i.addClass("static")}).done(function(t){return u(window).resize()}),setInterval(function(){var t;return a.find(".active").length&&(t=a.find(".active").next(".media")),t&&t.length||(t=a.find(".media").first()),a.find(".active").removeClass("active"),t.addClass("active")},5e3)})},j=function(t){return l.is(".open-archive")?(e(),t.preventDefault()):d()},d=function(){return s(),w.find(".active").removeClass("active"),l.addClass("open-archive no-scroll")},e=function(){var t;return l.removeClass("open-archive no-scroll"),t=window.location.href.split("#")[0],history.pushState(null,null,t),u(window).scroll()},g=function(t){var e,n,i,a,o;return i=u(this),r=u("#lightbox-media"),i.find("img").length?(a=i.find("img").attr("src"),r.css({backgroundImage:"url("+a+")"})):i.find("video").length?(o=i.find("video")[0],n=u(o).clone()[0],r.append(n),n.currentTime=o.currentTime,n.volume=.8,n.muted=!1,n.play()):i.css("background-image")&&(e=i.css("background-image"),r.css({backgroundImage:e})),l.addClass("open-lightbox no-scroll"),s()},n=function(t){return r=u("#lightbox-media"),l.removeClass("open-lightbox no-scroll"),setTimeout(function(){return r.html("").attr("style","")},200),u(window).scroll()},s=function(){return u(".media-block video").each(function(t,e){return e.volume=0})},q=function(t){return l.toggleClass("open-menu no-scroll")},H=function(t){var e,n;if(e=u(this).data("id"),(n=u('.media[data-id="'+e+'"]')).length)return u(".media").removeClass("show"),n.addClass("show")},t=function(t){return u(".media").removeClass("show")},T=function(t){var e,n;return n=u(this).data("id"),e=u('.tab-content[data-id="'+n+'"]'),u(".tab, .tab-content").removeClass("active"),u(this).addClass("active"),e.addClass("active")},I=function(t){var e,n,i;return n=u(this).parents(".expand-wrapper"),e=n.find(".expand-content"),n.toggleClass("open"),i=n.is(".open")?n.find(".expand-inner").innerHeight():0,e.animate({height:i},500,function(){if(n.is(".open"))return e.css({height:"auto"})})},o=function(t){return i.length&&u(".blocks-inner").css({paddingBottom:i.innerHeight()+30}),u(".block-media.slideshow").each(function(t,e){var n,i;if(i=(e=u(e)).attr("data-ratio"))return n=e.innerWidth()*i,e.css({height:n+30+"px"})})},a=function(t){if("Escape"===t.key&&(l.is(".open-lightbox")&&n(),l.is(".open-archive")))return e()},b=0,c=function(t){var e,n,i,a,s,o,r,c,d;if(!l.is(".page")&&!l.is(".archive"))return d=u(window).innerHeight(),c=d/2,s=u(window).scrollTop(),d+s,b<s?"down":"up",a=v.position().top,e=v.data("url"),a<=s?l.addClass("in-chapter"):l.removeClass("in-chapter"),r=[],u(".block.section-title").each(function(t,e){var n;if(u(e).offset().top-h.innerHeight()-1<=s)return n=u(e).attr("id"),r.push(n)}),(n=r[r.length-1])?(i=w.find('[data-slug="'+n+'"]')).is(".active")||(i.addClass("active"),o=i.find("a").attr("href"),history.pushState(null,null,e+o)):window.location.hash.length&&history.pushState(null,null,"#"),u(".section-title").not(i).removeClass("active"),u(".media-block video").each(function(t,e){var n,i,a,o,r,l;return u(e).is(".init")||(u(e).addClass("init").attr("loop","loop"),e.play()),a=(i=u(e).innerHeight()/2)+(o=u(e).offset().top),n=u(e).innerHeight()+o,r=o-s,l=0<=s-a+c?f(n-s,0,c+i):f(r,d,c-i),e.volume=l}),b=s},f=function(t,e,n){var i;return.8<(i=.8*(t-e)/(n-e)+0)&&(i=.8),i<0&&(i=0),i},S=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},u("body").on("vclick",".archive-toggle",j),u("body").on("vclick",".menu-toggle",q),u("body").on("mouseenter",".chapter-square:not(.show)",H),u("body").on("mouseleave",".chapter-square",t),u("body").on("vclick",".tabs .tab:not(.active)",T),u("body").on("vclick",".expand-toggle",I),u("body").on("vclick",".section-anchor",k),u("body").on("vclick","a.chapter-square",C),u("body").on("vclick",".block-media",g),u("body").on("vclick",".lightbox-close, #lightbox-media",n),u("body").on("keyup",a),u(window).on("resize",o),u(window).on("load",function(){return m(),x()}),o()});