jQuery(document).ready(function(v){var l,d,c,e,t,n,u,m,i,g,a,b,s,w,h,o,r,f,p,y,C,k,x,H,S,T,D,W,I,P,j,q,L,z,E,B,G,N;return c=v("body"),w=v("main"),W=v(".section-titles"),l=v("#archive"),d=v(".archive-medias"),v("#lightbox"),s=v("#lightbox-media"),u=v("header.desktop"),v("header.mobile"),i=v("footer"),.8,200,500,30,b=function(){return!!['""mobile""','"mobile"',"mobile"].includes(c.css("content"))},I=function(e){var t,n,i,a,o;if(e.preventDefault(),e.stopPropagation(),n=v(this).data("id"),i=v(this).data("title"),o=this.href,history.pushState(null,null,o),a=w.position().top,v("html, body").animate({scrollTop:a},500),w.data("id")!==n)return w.addClass("loading").data("id",n).data("url",o),(t=u.find(".chapter-title")).attr("href",o),t.html(i),C(n),!1},C=function(e){var t;return w.removeClass("loaded").addClass("loading"),t=SiteSettings.url.api+"chapter/"+e,v.ajax({url:t,type:"GET",dataType:"html",success:function(e){return w.html(e),w.removeClass("loading").addClass("loaded"),H()},error:function(e,t,n){return console.warn(e,t,n)}})},H=function(){var t;return t=v(".blocks"),W.html(""),t.find(".section-title").each(function(e,t){var n,i,a;if(i=v(t).find(".section-title-text").text())return n=z(i),v(t).attr("id",n),a=v('<span class="section-title"></span>').attr("data-slug",n).html('<a href="#'+n+'" class="section-anchor">'+i+"</a>"),W.append(a)}),t.find(".media-block").each(function(e,t){var n;if(v(t).is(".full-media-block")||v(t).is(".center-media-block")){if((n=v(t).find(".block-body")).text())return;return n.parents(".block-text").length&&n.parents(".block-text").remove(),n.remove()}}),t.find("video").each(function(e,t){var n,i;if((n=v(t).parent()).append(v('<div class="btn"></div>')),t.oncanplay=function(e){return n.addClass("loaded")},b())t.autoplay=!1,t.muted=!1,t.volume=1;else if(t.autoplay=!0,n.addClass("muted mutable"),void 0!==(i=t.play()))return i.then(function(){return v(t).on("timeupdate",function(){var e;return e=v(t=this).parent(".media"),t.paused?e.addClass("muted"):(e.removeClass("muted"),v(t).off("timeupdate"))})}).catch(function(e){return console.warn(e)})}),t.imagesLoaded().always(function(){var e;return(e=window.location.hash)&&D(e,!1),v(window).on("scroll",p),t.addClass("loaded"),p()})},x=function(){return d.masonry({itemSelector:".col",transitionDuration:0}),d.masonry("on","layoutComplete",function(){return d.addClass("masonry")}),d.find(".block-media").each(function(e,t){var n;return n=v(t).find("video"),v(t).find("img").length?v(t).find("img")[0].onload=function(){if(d.is(".masonry"))return d.masonry()}:n.length?(b()?n[0].controls=!0:(n[0].controls=!1,v(t).addClass("paused")),v(t).find("video").on("loadeddata",function(){if(d.is(".masonry"))return d.masonry()})):void 0})},j=function(e){var t;return e.preventDefault(),t=e.target.hash,history.pushState(null,null,t),D(t,!0)},D=function(e,t){var n,i,a,o;if(e=decodeURIComponent(e),(a=v(".section-title"+e)).length?(o=a.position().top,"none"!==u.css("display")&&(o-=u.innerHeight()+1),t?v("html, body").animate({scrollTop:o},500):v("html, body").scrollTop(o)):v("html, body").scrollTop(0),e.includes("#archive")){if(E(),n=parseInt(e.split("-")[1]),!Number.isInteger(n))return;if(i=v(d.find(".archive-media")[n-1]))return k(i)}},S=function(){return v(".block-media.slideshow").each(function(e,a){var o;return o=0,(a=v(a)).imagesLoaded().progress(function(e,t){var n,i;if(n=t.img,i=v(n).parent(),n.naturalHeight>o)return o=n.naturalHeight,a.find(".static").removeClass("static"),a.attr("data-ratio",n.naturalHeight/n.naturalWidth),i.addClass("static")}).done(function(e){return v(window).resize()}),setInterval(function(){var e;return a.find(".active").length&&(e=a.find(".active").next(".media")),e&&e.length||(e=a.find(".media").first()),a.find(".active").removeClass("active"),e.addClass("active")},5e3)})},e=function(e){var t,n;if(t=e.target.hash,n=v(t),t&&n&&n.length)return e.preventDefault(),e.stopPropagation(),k(n)},E=function(e){return e&&e.stopPropagation(),c.is(".open-archive")?(t(),e?e.preventDefault():void 0):y()},y=function(){return h(),W.find(".active").removeClass("active"),c.addClass("open-archive no-scroll"),d.masonry()},t=function(){var e;return c.removeClass("open-archive no-scroll"),e=window.location.href.split("#")[0],history.pushState(null,null,e),v(window).scroll()},P=function(e){var t,n;if(n=(t=v(this)).find("video"),b()&&n.length)n[0].paused?n[0].play():n[0].pause();else if(!t.find(".muted").length&&!v(e.target).is(".btn"))return k(t)},k=function(e){var t,n,i,a,o,r;if(e.length)return s=v("#lightbox-media"),e.find("object").length?(a=e.find("object")[0],n=v(a).clone()[0],s.append(n)):e.find("img").length?(o=e.find("img").attr("src"),s.css({backgroundImage:"url("+o+")"})):e.find("video").length?(r=e.find("video")[0],i=v(r).clone()[0],s.append(i),i.currentTime=r.currentTime,i.volume=.8,i.muted=!1,i.play()):e.css("background-image")&&(t=e.css("background-image"),s.css({backgroundImage:t})),c.addClass("open-lightbox no-scroll"),h()},n=function(e){var t;return s=v("#lightbox-media"),c.removeClass("open-lightbox no-scroll"),c.hasClass("open-archive")&&(t=window.location.href.split("#")[0],history.pushState(null,null,t+"#archive")),setTimeout(function(){return s.html("").attr("style","")},200),v(window).scroll()},function(){if(!b())return v(".media-block video").each(function(e,t){return t.muted=!1,t.play()})},h=function(){if(!b())return v(".media-block video").each(function(e,t){return t.volume=0})},N=function(){var e,t;return e=v(this).parents(".media"),t=v(e).find("video"),e.toggleClass("muted"),t[0]&&(t[0].muted=e.is(".muted")),v(window).scroll()},G=function(e){return e.preventDefault(),e.stopPropagation(),c.toggleClass("open-menu no-scroll")},q=function(e){var t,n;if(t=v(this).data("id"),(n=v('.media[data-id="'+t+'"]')).length)return v(".media").removeClass("show"),n.addClass("show")},a=function(e){return v(".media").removeClass("show")},L=function(e){var t,n;return n=v(this).data("id"),t=v('.tab-content[data-id="'+n+'"]'),v(".tab, .tab-content").removeClass("active"),v(this).addClass("active"),t.addClass("active")},B=function(e){var t,n,i;return e.preventDefault(),e.stopPropagation(),n=v(this).parents(".expand-wrapper"),t=n.find(".expand-content"),n.toggleClass("open"),i=n.is(".open")?n.find(".expand-inner").innerHeight():0,t.animate({height:i},500,function(){if(n.is(".open"))return t.css({height:"auto"})})},g=function(){var s,l;return l=v(window).innerWidth(),s=v(window).innerHeight(),v(".full-video-block video").each(function(e,t){var n,i,a,o,r;if(!v(t).parents(".media").parents(".mobile").length&&(r=v(t)[0].videoWidth/v(t)[0].videoHeight))return a=s*r<=l?(o="100%",n="auto",i=-(v(t).innerWidth()-l)/2,0):(o="auto",n="100%",i=0,-(v(t).innerHeight()-s)/2),v(t).css({width:o,height:n,left:i,top:a})})},f=function(e){return i.length&&v(".blocks-inner").css({paddingBottom:i.innerHeight()+30}),v(".block-media.slideshow").each(function(e,t){var n,i;if(i=(t=v(t)).attr("data-ratio"))return n=t.innerWidth()*i,t.css({height:n+30+"px"})}),d.is(".masonry")&&d.masonry(),g()},r=function(e){if("Escape"===e.key&&(c.is(".open-lightbox")&&n(),c.is(".open-archive")))return t()},T=0,p=function(e){var t,n,i,a,h,o,r,s,f,p;if(!c.is(".page")&&!c.is(".archive"))return v(window).innerWidth(),p=v(window).innerHeight(),f=p/2,h=v(window).scrollTop(),p+h,T<h?"down":"up",a=w.position().top,t=w.data("url"),r=l.offset().top<=h+p,a<=h?c.addClass("in-chapter"):c.removeClass("in-chapter"),r?(c.addClass("show-archive"),v(".section-title").removeClass("active")):(c.removeClass("show-archive"),s=[],v(".block.section-title").each(function(e,t){var n;if(v(t).offset().top-u.innerHeight()-1<=h)return n=v(t).attr("id"),s.push(n)}),(n=s[s.length-1])?(i=W.find('[data-slug="'+n+'"]')).is(".active")||(i.addClass("active"),o=i.find("a").attr("href"),c.is(".open-archive")||c.is(".open-lightbox")||history.pushState(null,null,t+o)):window.location.hash.length&&(c.is(".open-archive")||c.is(".open-lightbox")||history.pushState(null,null,"#")),v(".section-title").not(i).removeClass("active")),d.find(".block-media video").each(function(e,t){return b()?t.controls=!0:(t.controls=!1,v(t).parents(".block").addClass("paused"))}),v(".media-block video").each(function(e,t){var n,i,a,o,r,s,l,d,c,u;return(n=v(t).parents(".media")).removeClass("paused"),b()?(n.removeClass("muted"),t.controls=!0,t.autoplay=!1,t.muted=!1,void(t.volume=1)):(t.controls=!1,t.autoplay=!0,v(t)[0].videoWidth,v(t)[0].videoHeight,s=(r=v(t).innerHeight()/2)+(d=v(t).offset().top),a=v(t).innerHeight()+d,c=d-h,l=h-s+f,o=a-h,u=n.is(".muted")?0:0<=l?m(o,0,f+r):m(c,p,f-r),t.volume=u,void 0!==(i=t.play())?i.then(function(){return 0<u?(v(t).addClass("play"),t.muted=!1):v(t).removeClass("play")}).catch(function(e){return console.warn(e.message)}):void 0)}),g(),T=h},o=function(){if(!b())return v(".media-block video").each(function(e,t){return t.play()})},m=function(e,t,n){var i;return.8<(i=.8*(e-t)/(n-t)+0)&&(i=.8),i<0&&(i=0),i},z=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},c.on("vclick",".body-text a",e),c.on("vclick",".archive-toggle",E),c.on("vclick",".menu-toggle",G),c.on("mouseenter",".chapter-square:not(.show)",q),c.on("mouseleave",".chapter-square",a),c.on("vclick",".tabs .tab:not(.active)",L),c.on("click",".expand-toggle",B),c.on("vclick",".section-anchor",j),c.on("click","a.chapter-square",I),c.on("click",".block-media",P),c.on("click",".mutable .btn",N),c.on("vclick",".lightbox-close, #lightbox-media",n),c.on("keyup",r),c.on("click",o),v(window).on("resize",f),v(window).on("load",function(){return H(),S(),x(),g()}),f()});